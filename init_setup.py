# -*- coding: utf-8 -*-
"""í”„ë¡œì íŠ¸ ìë™ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ (Python)

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Sax5bfcSar_WOQrViwjkzDyjBKH2sEC8
"""

import os
import textwrap

# ----------------------------------------------------------------------
# ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” 'ai-assist-google' í”„ë¡œì íŠ¸ì˜ ì „ì²´ ë””ë ‰í† ë¦¬ êµ¬ì¡°ì™€
# ëª¨ë“  í•„ìˆ˜ íŒŒì¼ì„ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
#
# ì‚¬ìš© ë°©ë²•:
# 1. ì´ íŒŒì¼ì„ 'create_project.py'ë¡œ ì €ì¥í•©ë‹ˆë‹¤.
# 2. í„°ë¯¸ë„ì„ ì—´ê³  ì´ íŒŒì¼ì´ ìˆëŠ” ìœ„ì¹˜ë¡œ ì´ë™í•©ë‹ˆë‹¤.
# 3. 'python create_project.py' ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
# 4. 'ai-assist-google' ë””ë ‰í† ë¦¬ê°€ ìƒì„±ë˜ë©°, ëª¨ë“  íŒŒì¼ì´ ì¤€ë¹„ë©ë‹ˆë‹¤.
# ----------------------------------------------------------------------

# --- íŒŒì¼ ë‚´ìš© ì •ì˜ ---

# ê° íŒŒì¼ì˜ ë‚´ìš©ì€ ì—¬ê¸°ì— ë‹¤ì¤‘ ë¼ì¸ ë¬¸ìì—´ë¡œ ì •ì˜ë©ë‹ˆë‹¤.
# ì´ ë‚´ìš©ì€ ëŒ€í™”ì—ì„œ ìƒì„±ëœ ì½”ë“œë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.

README_MD_CONTENT = """
# AI ì—…ë¬´ ìë™í™” ë¹„ì„œ (ai-assist-google)

ë³¸ í”„ë¡œì íŠ¸ëŠ” Google AI(Gemini), Gmail, Google Calendarì™€ ì—°ë™í•˜ì—¬ ë°˜ë³µì ì¸ ì—…ë¬´ë¥¼ ìë™í™”í•˜ëŠ” AI ë¹„ì„œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. LangChain/LangGraphë¥¼ í™œìš©í•œ Multi-Agent ì•„í‚¤í…ì²˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©ì ìš”ì²­ì˜ ì˜ë„ë¥¼ íŒŒì•…í•˜ê³ , RAGë¥¼ í†µí•´ ë‚´ë¶€ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì—¬ ì •í™•í•˜ê³  í’ë¶€í•œ ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” Streamlitìœ¼ë¡œ êµ¬í˜„ëœ ì›¹ UIë¥¼ í†µí•´ AI ë¹„ì„œì™€ ëŒ€í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸš€ í”„ë¡œì íŠ¸ ì•„í‚¤í…ì²˜

1.  **Frontend (Streamlit)**: ì‚¬ìš©ìê°€ AIì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” ì›¹ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ë©”ì‹œì§€ë¥¼ ë°±ì—”ë“œ APIë¡œ ì „ì†¡í•˜ê³ , ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µì„ ë°›ì•„ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
2.  **Backend (FastAPI)**: Streamlit ì•±ì˜ ìš”ì²­ì„ ë°›ì•„ ì²˜ë¦¬í•˜ëŠ” API ì„œë²„ì…ë‹ˆë‹¤.
3.  **Master Agent (LangGraph)**: ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ ê°€ì¥ ë¨¼ì € ë°›ì•„ ì˜ë„ë¥¼ ë¶„ì„í•˜ê³ , ì–´ë–¤ ì „ë¬¸ê°€ ì—ì´ì „íŠ¸(Specialist Agent)ì—ê²Œ ì‘ì—…ì„ ìœ„ì„í• ì§€ ê²°ì •í•˜ëŠ” ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° ì—­í• ì„ í•©ë‹ˆë‹¤.
4.  **Specialist Agents (LangChain)**: íŠ¹ì • ë„ë©”ì¸ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ì—ì´ì „íŠ¸ë“¤ì…ë‹ˆë‹¤.
    * **Gmail Agent**: Google Gmail APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì¼ ìš”ì•½, ê²€ìƒ‰, ë¶„ë¥˜ ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
    * **Calendar Agent**: Google Calendar APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì¼ì • ì¡°íšŒ, ìš”ì•½ ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
    * **RAG Agent**: FAISS ê¸°ë°˜ì˜ Vector DBì— ì €ì¥ëœ ë‚´ë¶€ ë¬¸ì„œ(ë³´ê³ ì„œ, ë§¤ë‰´ì–¼ ë“±)ë¥¼ ê²€ìƒ‰í•˜ì—¬ ì§ˆë¬¸ì— ë‹µë³€í•©ë‹ˆë‹¤.
5.  **Tools**: ê° ì—ì´ì „íŠ¸ê°€ ì‚¬ìš©í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ì‹¤ì œ Google APIë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜ Vector DBë¥¼ ê²€ìƒ‰í•˜ëŠ” í•¨ìˆ˜ë“¤ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.
6.  **Vector Store (FAISS)**: RAGë¥¼ ìœ„í•´ í…ìŠ¤íŠ¸ ë¬¸ì„œë“¤ì´ ì„ë² ë”©ë˜ì–´ ì €ì¥ë˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤.
"""
## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

"""
ai-assist-google/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ app.py              # Streamlit í”„ë¡ íŠ¸ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜
â”‚   â””â”€â”€ requirements.txt    # í”„ë¡ íŠ¸ì—”ë“œ íŒŒì´ì¬ íŒ¨í‚¤ì§€
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ chat.py         # /chat API ì—”ë“œí¬ì¸íŠ¸ (FastAPI ë¼ìš°í„°)
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ master_agent.py # ì‘ì—…ì„ ë¼ìš°íŒ…í•˜ëŠ” ë©”ì¸ ì—ì´ì „íŠ¸ (LangGraph)
â”‚   â”‚   â”œâ”€â”€ specialist_agents.py # Gmail, Calendar, RAG ì—ì´ì „íŠ¸ ì •ì˜
â”‚   â”‚   â””â”€â”€ state.py        # LangGraph ìƒíƒœ ì •ì˜
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â””â”€â”€ config.py       # í™˜ê²½ë³€ìˆ˜ ë¡œë“œ
â”‚   â”œâ”€â”€ rag/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ ingest.py       # ë¬¸ì„œë¥¼ ë¡œë“œí•˜ê³  Vector DBì— ì €ì¥í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
â”‚   â”‚   â””â”€â”€ retriever.py    # Vector DBì—ì„œ ë¬¸ì„œë¥¼ ê²€ìƒ‰í•˜ëŠ” ë¡œì§
â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ google_services.py # Gmail, Calendar API í˜¸ì¶œ í•¨ìˆ˜ (Tools)
â”‚   â”œâ”€â”€ main.py             # FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì 
â”‚   â””â”€â”€ requirements.txt    # ë°±ì—”ë“œ íŒŒì´ì¬ íŒ¨í‚¤ì§€
â”œâ”€â”€ vector_store/
â”‚   â””â”€â”€ faiss_index/        # FAISS ì¸ë±ìŠ¤ê°€ ì €ì¥ë  ë””ë ‰í† ë¦¬
â”‚       â””â”€â”€ .gitkeep
â”œâ”€â”€ documents/
â”‚   â””â”€â”€ sample_report.txt   # RAGë¡œ ì‚¬ìš©í•  ìƒ˜í”Œ ë¬¸ì„œ
â”œâ”€â”€ .env.example            # í™˜ê²½ë³€ìˆ˜ ì„¤ì • ì˜ˆì‹œ íŒŒì¼
â””â”€â”€ README.md               # í”„ë¡œì íŠ¸ ì•ˆë‚´ ë¬¸ì„œ
```

## ì…‹ì—… ë° ì‹¤í–‰ ë°©ë²•

### 1. Google Cloud ë° API ì„¤ì •

1.  **Google Cloud Project ìƒì„±**: Google Cloud Consoleì—ì„œ ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
2.  **API í™œì„±í™”**: ìƒì„±í•œ í”„ë¡œì íŠ¸ì—ì„œ ë‹¤ìŒ APIë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.
    * `Vertex AI API` (ë˜ëŠ” `Generative Language API`)
    * `Gmail API`
    * `Google Calendar API`
3.  **API í‚¤ ìƒì„±**: `API ë° ì„œë¹„ìŠ¤` > `ì‚¬ìš©ì ì¸ì¦ ì •ë³´`ì—ì„œ **API í‚¤**ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ í‚¤ëŠ” Google AI ëª¨ë¸ í˜¸ì¶œì— ì‚¬ìš©ë©ë‹ˆë‹¤.
4.  **OAuth 2.0 í´ë¼ì´ì–¸íŠ¸ ID ìƒì„±**:
    * `API ë° ì„œë¹„ìŠ¤` > `OAuth ë™ì˜ í™”ë©´`ì—ì„œ í•„ìš”í•œ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ë™ì˜ í™”ë©´ì„ êµ¬ì„±í•©ë‹ˆë‹¤. (í…ŒìŠ¤íŠ¸ ëª©ì ì¼ ê²½ìš° 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì'ì— ë³¸ì¸ Google ê³„ì • ì¶”ê°€)
    * `ì‚¬ìš©ì ì¸ì¦ ì •ë³´`ì—ì„œ **OAuth 2.0 í´ë¼ì´ì–¸íŠ¸ ID**ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    * ìƒì„±ëœ ì¸ì¦ ì •ë³´(JSON íŒŒì¼)ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `credentials.json` ì´ë¦„ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.

### 2. í”„ë¡œì íŠ¸ í™˜ê²½ ì„¤ì •

1.  **ì €ì¥ì†Œ ë³µì œ ë° `.env` íŒŒì¼ ìƒì„±**:
    ```bash
    git clone <repository_url>
    cd ai-assist-google
    cp .env.example .env
    ```
2.  `.env` íŒŒì¼ì— 1ë‹¨ê³„ì—ì„œ ì–»ì€ ì •ë³´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.

### 3. RAG ë°ì´í„° ì¤€ë¹„

1.  `documents` ë””ë ‰í† ë¦¬ì— AIê°€ ì°¸ì¡°í•  í…ìŠ¤íŠ¸ íŒŒì¼(ì˜ˆ: `.txt`, `.pdf`, `.md`)ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
2.  ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ë¬¸ì„œë¥¼ Vector DBì— ì €ì¥í•©ë‹ˆë‹¤.
    ```bash
    # (ê°€ìƒí™˜ê²½ í™œì„±í™” í›„)
    pip install -r server/requirements.txt
    python -m server.rag.ingest
    ```vector_store/faiss_index` ë””ë ‰í† ë¦¬ì— ì¸ë±ìŠ¤ íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.

### 4. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰

1.  **ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰**:
    ```bash
    # (ê°€ìƒí™˜ê²½ í™œì„±í™” í›„)
    # pip install -r server/requirements.txt # ì´ë¯¸ ì„¤ì¹˜í–ˆë‹¤ë©´ ìƒëµ
    uvicorn server.main:app --host 0.0.0.0 --port 8000 --reload
    ```
2.  **í”„ë¡ íŠ¸ì—”ë“œ ì•± ì‹¤í–‰** (ìƒˆ í„°ë¯¸ë„ì—ì„œ):
    ```bash
    # (ê°€ìƒí™˜ê²½ í™œì„±í™” í›„)
    pip install -r app/requirements.txt
    streamlit run app/app.py
    ```
3.  ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:8501` ì£¼ì†Œë¡œ ì ‘ì†í•˜ì—¬ AI ë¹„ì„œì™€ ëŒ€í™”ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.
'''

ENV_EXAMPLE_CONTENT = '''
# Google AI (Gemini)
# https://aistudio.google.com/app/apikey ì—ì„œ API í‚¤ë¥¼ ë°œê¸‰ë°›ìœ¼ì„¸ìš”.
GOOGLE_API_KEY="YOUR_GOOGLE_API_KEY"

# ì‚¬ìš©í•  Google AI ëª¨ë¸ ì´ë¦„
GEMINI_MODEL_NAME="gemini-1.5-flash-latest"

# RAG ê´€ë ¨ ì„¤ì •
EMBEDDING_MODEL_NAME="text-embedding-004"
VECTOR_STORE_PATH="./vector_store/faiss_index"
DOCUMENT_SOURCE_DIR="./documents"

# Google OAuth
# Google Cloud Consoleì—ì„œ ë‹¤ìš´ë¡œë“œí•œ credentials.json íŒŒì¼ì˜ ê²½ë¡œ
GOOGLE_CREDENTIALS_PATH="./credentials.json"
# OAuth í† í°ì´ ì €ì¥ë  ê²½ë¡œ
TOKEN_PATH="./token.json"
# OAuth ë¦¬ë””ë ‰ì…˜ URI (ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš©)
REDIRECT_URI="http://localhost:8501"
'''

APP_PY_CONTENT = '''
# app/app.py
import streamlit as st
import requests
import json

# --- í˜ì´ì§€ ì„¤ì • ---
st.set_page_config(
    page_title="AI ì—…ë¬´ ìë™í™” ë¹„ì„œ",
    page_icon="ğŸ¤–",
    layout="wide"
)

# --- ë°±ì—”ë“œ API ì£¼ì†Œ ---
BACKEND_API_URL = "http://localhost:8000/api/chat"

# --- UI êµ¬ì„± ---
st.title("ğŸ¤– AI ì—…ë¬´ ìë™í™” ë¹„ì„œ")
st.markdown('''
ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ë‹¹ì‹ ì˜ ì—…ë¬´ë¥¼ ë•ëŠ” AI ë¹„ì„œì…ë‹ˆë‹¤.  
ë©”ì¼ ì •ë¦¬, ì¼ì • í™•ì¸, ë¬¸ì„œ ìš”ì•½ ë“± ë‹¤ì–‘í•œ ì‘ì—…ì„ ìš”ì²­í•´ë³´ì„¸ìš”.

**ì˜ˆì‹œ ì§ˆë¬¸:**
- "ì˜¤ëŠ˜ ë‚´ ìº˜ë¦°ë”ì— ë¬´ìŠ¨ ì¼ì •ì´ ìˆì–´?"
- "AI ê´€ë ¨í•´ì„œ ìƒˆë¡œ ì˜¨ ë©”ì¼ ì°¾ì•„ì¤˜"
- "ìµœì‹  AI ê¸°ìˆ  ë³´ê³ ì„œ ìš”ì•½í•´ì¤˜"
''')

# --- ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™” ---
# 'messages'ëŠ” ì±„íŒ… ê¸°ë¡ì„ ì €ì¥í•©ë‹ˆë‹¤.
if "messages" not in st.session_state:
    st.session_state.messages = []

# --- ì±„íŒ… ê¸°ë¡ í‘œì‹œ ---
# ì´ì „ ëŒ€í™” ë‚´ìš©ì„ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
for message in st.session_state.messages:
    with st.chat_message(message["role"]):
        st.markdown(message["content"])

# --- ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬ ---
# st.chat_inputì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìë¡œë¶€í„° ì…ë ¥ì„ ë°›ìŠµë‹ˆë‹¤.
if prompt := st.chat_input("ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?"):
    # ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë©”ì‹œì§€ë¥¼ ì±„íŒ… ê¸°ë¡ì— ì¶”ê°€í•˜ê³  í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
    st.session_state.messages.append({"role": "user", "content": prompt})
    with st.chat_message("user"):
        st.markdown(prompt)

    # AIì˜ ì‘ë‹µì„ í‘œì‹œí•  ì¤€ë¹„ë¥¼ í•©ë‹ˆë‹¤.
    with st.chat_message("assistant"):
        message_placeholder = st.empty()
        message_placeholder.markdown("ìƒê° ì¤‘...")

        try:
            # ë°±ì—”ë“œ APIì— ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
            # ëŒ€í™” ê¸°ë¡ì„ í•¨ê»˜ ë³´ë‚´ ë¬¸ë§¥ì„ ìœ ì§€í•˜ë„ë¡ í•©ë‹ˆë‹¤.
            history = [
                (msg["content"], st.session_state.messages[i+1]["content"])
                for i, msg in enumerate(st.session_state.messages)
                if msg["role"] == "user" and i + 1 < len(st.session_state.messages)
            ]
            
            response = requests.post(
                BACKEND_API_URL,
                json={"message": prompt, "history": history}
            )
            response.raise_for_status()  # HTTP ì˜¤ë¥˜ ë°œìƒ ì‹œ ì˜ˆì™¸ ì²˜ë¦¬

            # API ì‘ë‹µì„ ë°›ì•„ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
            ai_response = response.json()["response"]
            message_placeholder.markdown(ai_response)
            
            # AIì˜ ì‘ë‹µì„ ì±„íŒ… ê¸°ë¡ì— ì¶”ê°€í•©ë‹ˆë‹¤.
            st.session_state.messages.append({"role": "assistant", "content": ai_response})

        except requests.exceptions.RequestException as e:
            message_placeholder.error(f"ë°±ì—”ë“œ ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
        except Exception as e:
            message_placeholder.error(f"ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
'''

APP_REQUIREMENTS_TXT_CONTENT = '''
streamlit
requests
'''

SERVER_MAIN_PY_CONTENT = '''
# server/main.py
import uvicorn
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from server.api import chat

# FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±
app = FastAPI(
    title="AI Assist Google - Backend",
    description="AI ì—…ë¬´ ìë™í™” ë¹„ì„œë¥¼ ìœ„í•œ ë°±ì—”ë“œ API ì„œë²„",
    version="1.0.0"
)

# CORS ë¯¸ë“¤ì›¨ì–´ ì„¤ì •
# ê°œë°œ í™˜ê²½ì—ì„œëŠ” ëª¨ë“  ì˜¤ë¦¬ì§„ì„ í—ˆìš©í•˜ì—¬ Streamlit ì•±ê³¼ì˜ í†µì‹ ì„ ì›í™œí•˜ê²Œ í•©ë‹ˆë‹¤.
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ë³´ì•ˆì„ ìœ„í•´ íŠ¹ì • ë„ë©”ì¸ë§Œ í—ˆìš©í•˜ì„¸ìš”.
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# API ë¼ìš°í„° í¬í•¨
app.include_router(chat.router, prefix="/api", tags=["Chat"])

@app.get("/", tags=["Root"])
async def read_root():
    '''
    ë£¨íŠ¸ ì—”ë“œí¬ì¸íŠ¸. API ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.
    '''
    return {"message": "AI Assist Google Backend is running."}

if __name__ == "__main__":
    # ì´ íŒŒì¼ì„ ì§ì ‘ ì‹¤í–‰í•  ê²½ìš° Uvicorn ì„œë²„ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.
    # ì‹¤ì œ ë°°í¬ ì‹œì—ëŠ” 'uvicorn server.main:app --host 0.0.0.0 --port 8000' ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    uvicorn.run(app, host="0.0.0.0", port=8000)
'''

SERVER_REQUIREMENTS_TXT_CONTENT = '''
fastapi
uvicorn[standard]
langchain
langgraph
langchain-google-genai
google-api-python-client
google-auth-httplib2
google-auth-oauthlib
faiss-cpu
langchain-community
pydantic-settings
python-dotenv
tiktoken
'''

API_CHAT_PY_CONTENT = '''
# server/api/chat.py
from fastapi import APIRouter
from pydantic import BaseModel
from typing import List, Tuple
from server.agents.master_agent import get_agent_executor

# API ë¼ìš°í„° ìƒì„±
router = APIRouter()

# ìš”ì²­ ë³¸ë¬¸(Request Body) ëª¨ë¸ ì •ì˜
class ChatRequest(BaseModel):
    message: str
    history: List[Tuple[str, str]] # (human_message, ai_message) í˜•íƒœì˜ ë¦¬ìŠ¤íŠ¸

# ì‘ë‹µ ë³¸ë¬¸(Response Body) ëª¨ë¸ ì •ì˜
class ChatResponse(BaseModel):
    response: str

@router.post("/chat", response_model=ChatResponse)
async def handle_chat(request: ChatRequest):
    '''
    ì‚¬ìš©ìì˜ ì±„íŒ… ë©”ì‹œì§€ë¥¼ ë°›ì•„ AI ì—ì´ì „íŠ¸ì˜ ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸.
    '''
    try:
        # LangGraphë¡œ êµ¬ì„±ëœ ì—ì´ì „íŠ¸ ì‹¤í–‰ê¸°(executor)ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
        agent_executor = get_agent_executor()
        
        # ì‚¬ìš©ìì˜ ë©”ì‹œì§€ì™€ ëŒ€í™” ê¸°ë¡ì„ ì…ë ¥ìœ¼ë¡œ ì—ì´ì „íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
        # LangChainì˜ invoke ë©”ì†Œë“œëŠ” ì—ì´ì „íŠ¸ì˜ ìµœì¢… ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
        result = agent_executor.invoke({
            "messages": [("user", request.message)],
            "history": request.history
        })
        
        # ê²°ê³¼ì—ì„œ AIì˜ ë§ˆì§€ë§‰ ì‘ë‹µì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
        # LangGraphì˜ ê²°ê³¼ëŠ” 'messages' í‚¤ì— ëŒ€í™” íë¦„ ì „ì²´ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
        ai_response = result['messages'][-1].content
        
        return ChatResponse(response=ai_response)
    except Exception as e:
        # ì—ëŸ¬ ë°œìƒ ì‹œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ê³ , ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        print(f"Error during chat processing: {e}")
        return ChatResponse(response=f"ì£„ì†¡í•©ë‹ˆë‹¤, ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
'''

AGENTS_STATE_PY_CONTENT = '''
# server/agents/state.py
from typing import TypedDict, Annotated, List
from langchain_core.messages import BaseMessage
import operator

class AgentState(TypedDict):
    '''
    LangGraphì˜ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” TypedDictì…ë‹ˆë‹¤.
    - messages: ëŒ€í™”ì˜ íë¦„ì„ ë‚˜íƒ€ë‚´ëŠ” ë©”ì‹œì§€ ë¦¬ìŠ¤íŠ¸
    - history: ì´ì „ ëŒ€í™” ê¸°ë¡
    '''
    messages: Annotated[List[BaseMessage], operator.add]
    history: list
'''

AGENTS_MASTER_AGENT_PY_CONTENT = '''
# server/agents/master_agent.py
from langgraph.graph import StateGraph, END
from .specialist_agents import (
    create_gmail_agent,
    create_calendar_agent,
    create_rag_agent,
    create_general_agent
)
from .state import AgentState
from ..tools.google_services import get_google_services_tools
from ..rag.retriever import get_rag_retriever

# --- 1. ì—ì´ì „íŠ¸ ë° ë„êµ¬ ì¤€ë¹„ ---
# ê° ì „ë¬¸ ì—ì´ì „íŠ¸ì™€ ë„êµ¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
gmail_tools = get_google_services_tools(['gmail'])
calendar_tools = get_google_services_tools(['calendar'])
rag_retriever = get_rag_retriever()

gmail_agent = create_gmail_agent(gmail_tools)
calendar_agent = create_calendar_agent(calendar_tools)
rag_agent = create_rag_agent(rag_retriever)
general_agent = create_general_agent()

# --- 2. LangGraph ë…¸ë“œ ì •ì˜ ---

def general_agent_node(state: AgentState):
    '''ì¼ë°˜ ëŒ€í™” ë…¸ë“œ'''
    result = general_agent.invoke(state)
    return {"messages": [result]}

def gmail_agent_node(state: AgentState):
    '''Gmail ê´€ë ¨ ì‘ì—… ì²˜ë¦¬ ë…¸ë“œ'''
    result = gmail_agent.invoke(state)
    return {"messages": [result]}

def calendar_agent_node(state: AgentState):
    '''Google Calendar ê´€ë ¨ ì‘ì—… ì²˜ë¦¬ ë…¸ë“œ'''
    result = calendar_agent.invoke(state)
    return {"messages": [result]}

def rag_agent_node(state: AgentState):
    '''RAG ê¸°ë°˜ ì§ˆì˜ì‘ë‹µ ì²˜ë¦¬ ë…¸ë“œ'''
    result = rag_agent.invoke(state)
    # RAG ì²´ì¸ì€ dictê°€ ì•„ë‹Œ contentë¥¼ ì§ì ‘ ë°˜í™˜í•˜ë¯€ë¡œ, BaseMessageë¡œ ë˜í•‘í•´ì•¼ í•©ë‹ˆë‹¤.
    from langchain_core.messages import AIMessage
    return {"messages": [AIMessage(content=result)]}


# --- 3. ë¼ìš°íŒ… ë¡œì§ ì •ì˜ ---

def route_message(state: AgentState):
    '''ì‚¬ìš©ì ë©”ì‹œì§€ì˜ ì˜ë„ë¥¼ íŒŒì•…í•˜ì—¬ ì ì ˆí•œ ì „ë¬¸ê°€ ì—ì´ì „íŠ¸ë¡œ ë¼ìš°íŒ…'''
    last_message = state['messages'][-1]
    message_content = last_message.content.lower()

    if "ë©”ì¼" in message_content or "gmail" in message_content:
        return "gmail_agent"
    elif "ì¼ì •" in message_content or "ìº˜ë¦°ë”" in message_content or "calendar" in message_content:
        return "calendar_agent"
    # 'ë³´ê³ ì„œ', 'ë¬¸ì„œ' ë“± RAGê°€ í•„ìš”í•œ í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    elif "ë³´ê³ ì„œ" in message_content or "ë¬¸ì„œ" in message_content or "ìš”ì•½" in message_content:
        # ì´ ë¶€ë¶„ì€ ë” ì •êµí•œ LLM ê¸°ë°˜ ë¼ìš°íŒ…ìœ¼ë¡œ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        return "rag_agent"
    else:
        return "general_agent"

# --- 4. ê·¸ë˜í”„(Graph) êµ¬ì„± ---

def get_agent_executor():
    '''LangGraph ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒì„±í•˜ê³  ì»´íŒŒì¼í•˜ì—¬ ì‹¤í–‰ê¸°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.'''
    workflow = StateGraph(AgentState)

    # ë…¸ë“œ ì¶”ê°€
    workflow.add_node("general_agent", general_agent_node)
    workflow.add_node("gmail_agent", gmail_agent_node)
    workflow.add_node("calendar_agent", calendar_agent_node)
    workflow.add_node("rag_agent", rag_agent_node)

    # ì§„ì…ì (Entry Point)ì—ì„œ ë¼ìš°íŒ… ë¡œì§ìœ¼ë¡œ ì—°ê²°
    workflow.set_entry_point("router")
    workflow.add_node("router", route_message)

    workflow.add_conditional_edges(
        "router",
        lambda x: x, # ë¼ìš°í„° í•¨ìˆ˜ì˜ ë°˜í™˜ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        {
            "general_agent": "general_agent",
            "gmail_agent": "gmail_agent",
            "calendar_agent": "calendar_agent",
            "rag_agent": "rag_agent",
        },
    )

    # ê° ì „ë¬¸ê°€ ì—ì´ì „íŠ¸ ë…¸ë“œ ì‹¤í–‰ í›„ì—ëŠ” ì¢…ë£Œ(END)
    workflow.add_edge("general_agent", END)
    workflow.add_edge("gmail_agent", END)
    workflow.add_edge("calendar_agent", END)
    workflow.add_edge("rag_agent", END)

    # ê·¸ë˜í”„ ì»´íŒŒì¼
    return workflow.compile()
'''

AGENTS_SPECIALIST_AGENTS_PY_CONTENT = '''
# server/agents/specialist_agents.py
from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder
from langchain_google_genai import ChatGoogleGenerativeAI
from langchain.agents import create_tool_calling_agent, AgentExecutor
from langchain.chains import create_retrieval_chain
from langchain.chains.combine_documents import create_stuff_documents_chain
from server.core.config import settings

# --- ê³µí†µ LLM ì´ˆê¸°í™” ---
llm = ChatGoogleGenerativeAI(
    model=settings.GEMINI_MODEL_NAME,
    google_api_key=settings.GOOGLE_API_KEY,
    temperature=0.7,
    convert_system_message_to_human=True # GeminiëŠ” system messageë¥¼ user messageë¡œ ë³€í™˜í•´ì•¼ í•¨
)

# --- 1. ì¼ë°˜ ëŒ€í™” ì—ì´ì „íŠ¸ ---
def create_general_agent():
    '''
    íŠ¹ë³„í•œ ë„êµ¬ ì—†ì´ ëŒ€í™”í•˜ëŠ” ê¸°ë³¸ ì—ì´ì „íŠ¸.
    '''
    prompt = ChatPromptTemplate.from_messages([
        ("system", "ë‹¹ì‹ ì€ ì¹œì ˆí•˜ê³  ìœ ëŠ¥í•œ AI ë¹„ì„œì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëª…í™•í•˜ê³  ê°„ê²°í•˜ê²Œ ë‹µë³€í•˜ì„¸ìš”."),
        MessagesPlaceholder(variable_name="history"),
        ("user", "{messages}"),
    ])
    chain = prompt | llm
    return chain

# --- 2. ReAct (Tool-Calling) ê¸°ë°˜ ì—ì´ì „íŠ¸ ìƒì„± í•¨ìˆ˜ ---
def create_react_agent(tools, system_prompt):
    '''
    ì£¼ì–´ì§„ ë„êµ¬ì™€ í”„ë¡¬í”„íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ReAct(Tool-Calling) ì—ì´ì „íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    '''
    prompt = ChatPromptTemplate.from_messages([
        ("system", system_prompt),
        MessagesPlaceholder(variable_name="history"),
        ("user", "{messages}"),
        MessagesPlaceholder(variable_name="agent_scratchpad"),
    ])
    agent = create_tool_calling_agent(llm, tools, prompt)
    executor = AgentExecutor(agent=agent, tools=tools, verbose=True)
    return executor

# --- 3. ì „ë¬¸ê°€ ì—ì´ì „íŠ¸ ìƒì„± ---
def create_gmail_agent(tools):
    '''Gmail ê´€ë ¨ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ì—ì´ì „íŠ¸'''
    system_prompt = "ë‹¹ì‹ ì€ Gmail ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìš”ì²­ì— ë”°ë¼ ë©”ì¼ì„ ê²€ìƒ‰í•˜ê³ , ìš”ì•½í•˜ê³ , ê´€ë ¨ ì •ë³´ë¥¼ ì œê³µí•˜ì„¸ìš”."
    return create_react_agent(tools, system_prompt)

def create_calendar_agent(tools):
    '''Google Calendar ê´€ë ¨ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ì—ì´ì „íŠ¸'''
    system_prompt = "ë‹¹ì‹ ì€ Google Calendar ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìš”ì²­ì— ë”°ë¼ ì¼ì •ì„ ì¡°íšŒí•˜ê³ , ìš”ì•½í•˜ì—¬ ì•Œë ¤ì£¼ì„¸ìš”."
    return create_react_agent(tools, system_prompt)

# --- 4. RAG ì—ì´ì „íŠ¸ (Retriever-Augmented Generation) ---
def create_rag_agent(retriever):
    '''
    ë‚´ë¶€ ë¬¸ì„œë¥¼ ê²€ìƒ‰í•˜ì—¬ ë‹µë³€ì„ ìƒì„±í•˜ëŠ” RAG ì—ì´ì „íŠ¸.
    ì´ ì—ì´ì „íŠ¸ëŠ” ReActê°€ ì•„ë‹Œ Retrieval Chainì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    '''
    system_prompt = (
        "ë‹¹ì‹ ì€ ë¬¸ì„œ ê²€ìƒ‰ ë° ìš”ì•½ ì „ë¬¸ê°€ì…ë‹ˆë‹¤."
        "ì£¼ì–´ì§„ ë¬¸ì„œ(context)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ë‹µë³€í•˜ì„¸ìš”."
        "ë¬¸ì„œì— ì—†ëŠ” ë‚´ìš©ì€ ë‹µë³€í•˜ì§€ ë§ê³ , ì •ë³´ê°€ ì—†ë‹¤ê³  ì†”ì§í•˜ê²Œ ë§í•˜ì„¸ìš”."
        "\\n\\n"
        "{context}"
    )
    prompt = ChatPromptTemplate.from_messages([
        ("system", system_prompt),
        MessagesPlaceholder(variable_name="history"),
        ("user", "{input}"), # Retrieval Chainì€ 'input'ì„ í‚¤ë¡œ ì‚¬ìš©
    ])
    
    # ë¬¸ì„œë¥¼ í”„ë¡¬í”„íŠ¸ì— ì±„ì›Œë„£ëŠ” ì²´ì¸
    question_answer_chain = create_stuff_documents_chain(llm, prompt)
    
    # ë¦¬íŠ¸ë¦¬ë²„ì™€ ë‹µë³€ ìƒì„± ì²´ì¸ì„ ê²°í•©
    rag_chain = create_retrieval_chain(retriever, question_answer_chain)
    
    # LangGraphì™€ í˜¸í™˜ë˜ë„ë¡ ì…ë ¥/ì¶œë ¥ í˜•ì‹ì„ ë§ì¶¤
    # 'messages'ì—ì„œ ì‚¬ìš©ì ì…ë ¥ì„ ì¶”ì¶œí•˜ì—¬ 'input'ìœ¼ë¡œ ì „ë‹¬
    def invoke_rag_chain(state):
        last_user_message = state['messages'][-1].content
        history = state.get('history', [])
        result = rag_chain.invoke({"input": last_user_message, "history": history})
        return result.get('answer', "ì£„ì†¡í•©ë‹ˆë‹¤, ë‹µë³€ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

    return invoke_rag_chain
'''

CORE_CONFIG_PY_CONTENT = '''
# server/core/config.py
from pydantic_settings import BaseSettings, SettingsConfigDict

class Settings(BaseSettings):
    '''
    .env íŒŒì¼ë¡œë¶€í„° í™˜ê²½ ë³€ìˆ˜ë¥¼ ë¡œë“œí•˜ëŠ” ì„¤ì • í´ë˜ìŠ¤ì…ë‹ˆë‹¤.
    '''
    GOOGLE_API_KEY: str
    GEMINI_MODEL_NAME: str = "gemini-1.5-flash-latest"
    EMBEDDING_MODEL_NAME: str = "text-embedding-004"
    VECTOR_STORE_PATH: str = "./vector_store/faiss_index"
    DOCUMENT_SOURCE_DIR: str = "./documents"
    GOOGLE_CREDENTIALS_PATH: str = "./credentials.json"
    TOKEN_PATH: str = "./token.json"
    REDIRECT_URI: str = "http://localhost:8501"

    model_config = SettingsConfigDict(env_file=".env", env_file_encoding='utf-8')

# ì„¤ì • ê°ì²´ ì¸ìŠ¤í„´ìŠ¤í™”
settings = Settings()
'''

RAG_INGEST_PY_CONTENT = '''
# server/rag/ingest.py
import os
from langchain_community.document_loaders import DirectoryLoader, TextLoader
from langchain.text_splitter import RecursiveCharacterTextSplitter
from langchain_google_genai import GoogleGenerativeAIEmbeddings
from langchain_community.vectorstores import FAISS
from server.core.config import settings
import sys

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ë¥¼ Python ê²½ë¡œì— ì¶”ê°€
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..', '..')))


def main():
    '''
    'documents' ë””ë ‰í† ë¦¬ì˜ ë¬¸ì„œë¥¼ ë¡œë“œ, ë¶„í• , ì„ë² ë”©í•˜ì—¬ FAISS ë²¡í„° ì €ì¥ì†Œì— ì €ì¥í•©ë‹ˆë‹¤.
    '''
    print("ë¬¸ì„œ ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...")
    # DirectoryLoaderë¥¼ ì‚¬ìš©í•˜ì—¬ ì§€ì •ëœ ë””ë ‰í† ë¦¬ì˜ ëª¨ë“  .txt íŒŒì¼ì„ ë¡œë“œí•©ë‹ˆë‹¤.
    loader = DirectoryLoader(
        settings.DOCUMENT_SOURCE_DIR,
        glob="**/*.txt",
        loader_cls=TextLoader,
        loader_kwargs={"encoding": "utf-8"}
    )
    documents = loader.load()
    if not documents:
        print(f"ë¡œë“œí•  ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤. '{settings.DOCUMENT_SOURCE_DIR}' ë””ë ‰í† ë¦¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.")
        return

    print(f"ì´ {len(documents)}ê°œì˜ ë¬¸ì„œë¥¼ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.")

    print("í…ìŠ¤íŠ¸ ë¶„í• ì„ ì‹œì‘í•©ë‹ˆë‹¤...")
    # í…ìŠ¤íŠ¸ë¥¼ ì˜ë¯¸ ìˆëŠ” ë‹¨ìœ„ë¡œ ë¶„í• í•©ë‹ˆë‹¤.
    text_splitter = RecursiveCharacterTextSplitter(chunk_size=1000, chunk_overlap=100)
    docs = text_splitter.split_documents(documents)
    print(f"ì´ {len(docs)}ê°œì˜ ì²­í¬(chunk)ë¡œ ë¶„í• ë˜ì—ˆìŠµë‹ˆë‹¤.")

    print("ì„ë² ë”© ë° ë²¡í„° ì €ì¥ì†Œ ìƒì„±ì„ ì‹œì‘í•©ë‹ˆë‹¤...")
    # Googleì˜ ì„ë² ë”© ëª¨ë¸ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
    embeddings = GoogleGenerativeAIEmbeddings(
        model=f"models/{settings.EMBEDDING_MODEL_NAME}",
        google_api_key=settings.GOOGLE_API_KEY
    )

    # ë¶„í• ëœ ë¬¸ì„œì™€ ì„ë² ë”© ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ FAISS ë²¡í„° ì €ì¥ì†Œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    db = FAISS.from_documents(docs, embeddings)

    # ìƒì„±ëœ ë²¡í„° ì €ì¥ì†Œë¥¼ ì§€ì •ëœ ê²½ë¡œì— ì €ì¥í•©ë‹ˆë‹¤.
    vector_store_dir = os.path.dirname(settings.VECTOR_STORE_PATH)
    if not os.path.exists(vector_store_dir):
        os.makedirs(vector_store_dir)
    db.save_local(settings.VECTOR_STORE_PATH)
    print(f"ë²¡í„° ì €ì¥ì†Œê°€ '{settings.VECTOR_STORE_PATH}' ê²½ë¡œì— ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")

if __name__ == "__main__":
    main()
'''

RAG_RETRIEVER_PY_CONTENT = '''
# server/rag/retriever.py
import os
from langchain_google_genai import GoogleGenerativeAIEmbeddings
from langchain_community.vectorstores import FAISS
from server.core.config import settings

def get_rag_retriever():
    '''
    ì €ì¥ëœ FAISS ì¸ë±ìŠ¤ë¥¼ ë¡œë“œí•˜ì—¬ LangChain Retriever ê°ì²´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    '''
    if not os.path.exists(settings.VECTOR_STORE_PATH):
        raise FileNotFoundError(
            f"Vector store not found at {settings.VECTOR_STORE_PATH}. "
            "Please run 'python -m server.rag.ingest' first."
        )

    embeddings = GoogleGenerativeAIEmbeddings(
        model=f"models/{settings.EMBEDDING_MODEL_NAME}",
        google_api_key=settings.GOOGLE_API_KEY
    )
    
    db = FAISS.load_local(
        settings.VECTOR_STORE_PATH,
        embeddings,
        allow_dangerous_deserialization=True # FAISS ë¡œë“œ ì‹œ í•„ìš”
    )
    
    return db.as_retriever()
'''

TOOLS_GOOGLE_SERVICES_PY_CONTENT = '''
# server/tools/google_services.py
import os
from langchain.tools import tool
from google.auth.transport.requests import Request
from google.oauth2.credentials import Credentials
from google_auth_oauthlib.flow import InstalledAppFlow
from googleapiclient.discovery import build
from googleapiclient.errors import HttpError
from server.core.config import settings

# --- Google API ì—°ë™ ì„¤ì • ---
# í•„ìš”í•œ ê¶Œí•œ ë²”ìœ„(SCOPES)ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
SCOPES = {
    'gmail': ['https://www.googleapis.com/auth/gmail.readonly'],
    'calendar': ['https://www.googleapis.com/auth/calendar.readonly']
}

def get_credentials(service_names):
    '''
    ì‚¬ìš©ì ì¸ì¦ì„ ì²˜ë¦¬í•˜ê³  ìœ íš¨í•œ Credentials ê°ì²´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    í† í°ì´ ì—†ê±°ë‚˜ ë§Œë£Œëœ ê²½ìš°, OAuth 2.0 íë¦„ì„ í†µí•´ ìƒˆë¡œ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.
    '''
    creds = None
    token_path = settings.TOKEN_PATH
    
    required_scopes = []
    for service in service_names:
        required_scopes.extend(SCOPES.get(service, []))
    
    if os.path.exists(token_path):
        creds = Credentials.from_authorized_user_file(token_path, required_scopes)
    
    if not creds or not creds.valid:
        if creds and creds.expired and creds.refresh_token:
            creds.refresh(Request())
        else:
            # ì´ ë¶€ë¶„ì€ Streamlit/FastAPI í™˜ê²½ì—ì„œ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.
            # ì´ˆê¸° ì‹¤í–‰ ì‹œ í„°ë¯¸ë„ì—ì„œ ì¸ì¦ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
            flow = InstalledAppFlow.from_client_secrets_file(
                settings.GOOGLE_CREDENTIALS_PATH, required_scopes
            )
            creds = flow.run_local_server(port=0)
        
        with open(token_path, 'w') as token:
            token.write(creds.to_json())
    return creds

# --- LangChain Tool ì •ì˜ ---

@tool
def search_gmail(query: str) -> str:
    '''
    "ì£¼ì–´ì§„ ì¿¼ë¦¬ë¡œ Gmailì„ ê²€ìƒ‰í•˜ì—¬ ìµœê·¼ 5ê°œ ë©”ì¼ì˜ ì œëª©ê³¼ ë³´ë‚¸ ì‚¬ëŒ ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
    ì˜ˆ: 'AI ê´€ë ¨ ìµœì‹  ë‰´ìŠ¤'
    '''
    try:
        creds = get_credentials(['gmail'])
        service = build('gmail', 'v1', credentials=creds)
        
        results = service.users().messages().list(userId='me', q=query, maxResults=5).execute()
        messages = results.get('messages', [])

        if not messages:
            return "í•´ë‹¹ ì¿¼ë¦¬ì— ëŒ€í•œ ë©”ì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."

        email_list = []
        for msg in messages:
            msg_data = service.users().messages().get(userId='me', id=msg['id']).execute()
            headers = msg_data['payload']['headers']
            subject = next((header['value'] for header in headers if header['name'] == 'Subject'), 'ì œëª© ì—†ìŒ')
            sender = next((header['value'] for header in headers if header['name'] == 'From'), 'ë°œì‹ ì ë¶ˆëª…')
            email_list.append(f"ì œëª©: {subject}\\në³´ë‚¸ ì‚¬ëŒ: {sender}\\n---")
        
        return "\\n".join(email_list)
    except HttpError as error:
        return f"Gmail API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {error}"
    except Exception as e:
        return f"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ ë°œìƒ: {e}"

@tool
def get_today_calendar_events() -> str:
    '''
    "ì˜¤ëŠ˜ì˜ Google Calendar ì¼ì •ì„ ëª¨ë‘ ê°€ì ¸ì™€ ìš”ì•½í•´ì„œ ë°˜í™˜í•©ë‹ˆë‹¤."
    '''
    from datetime import datetime, time, timezone, timedelta

    try:
        creds = get_credentials(['calendar'])
        service = build('calendar', 'v3', credentials=creds)

        KST = timezone(timedelta(hours=9))
        now = datetime.now(KST)
        time_min = datetime.combine(now.date(), time.min, tzinfo=KST).isoformat()
        time_max = datetime.combine(now.date(), time.max, tzinfo=KST).isoformat()

        events_result = service.events().list(
            calendarId='primary', timeMin=time_min, timeMax=time_max,
            singleEvents=True, orderBy='startTime'
        ).execute()
        events = events_result.get('items', [])

        if not events:
            return "ì˜¤ëŠ˜ ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤."

        event_list = ["ì˜¤ëŠ˜ì˜ ì¼ì •ì…ë‹ˆë‹¤:"]
        for event in events:
            start = event['start'].get('dateTime', event['start'].get('date'))
            start_dt = datetime.fromisoformat(start)
            start_str = start_dt.strftime('%H:%M') if 'dateTime' in event['start'] else 'í•˜ë£¨ ì¢…ì¼'
            event_list.append(f"- {start_str}: {event['summary']}")
        
        return "\\n".join(event_list)
    except HttpError as error:
        return f"Calendar API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {error}"
    except Exception as e:
        return f"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ ë°œìƒ: {e}"


def get_google_services_tools(services: list):
    '''ìš”ì²­ëœ ì„œë¹„ìŠ¤ì— ë”°ë¼ ê´€ë ¨ëœ ë„êµ¬ ë¦¬ìŠ¤íŠ¸ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.'''
    tools = []
    if 'gmail' in services:
        tools.append(search_gmail)
    if 'calendar' in services:
        tools.append(get_today_calendar_events)
    return tools
'''

SAMPLE_REPORT_TXT_CONTENT = '''
2024ë…„ AI ê¸°ìˆ  ë™í–¥ ë³´ê³ ì„œ

1. ì„œë¡ 
ì¸ê³µì§€ëŠ¥(AI) ê¸°ìˆ ì€ ì „ë¡€ ì—†ëŠ” ì†ë„ë¡œ ë°œì „í•˜ë©° ì‚°ì—… ì „ë°˜ì— í˜ì‹ ì„ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤. ë³¸ ë³´ê³ ì„œëŠ” 2024ë…„ í˜„ì¬ AI ê¸°ìˆ ì˜ ì£¼ìš” ë™í–¥ì„ ë¶„ì„í•˜ê³ , í–¥í›„ ì „ë§ì„ ì œì‹œí•˜ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.

2. ì£¼ìš” ë™í–¥
ê°€. ê±°ëŒ€ ì–¸ì–´ ëª¨ë¸(LLM)ì˜ ê³ ë„í™”
- GPT-4, Gemini ë“± ë”ìš± í–¥ìƒëœ ì„±ëŠ¥ì˜ ëª¨ë¸ë“¤ì´ ë“±ì¥í•˜ë©°, ì¸ê°„ê³¼ ìœ ì‚¬í•œ ìˆ˜ì¤€ì˜ ëŒ€í™” ë° ì°½ì‘ ëŠ¥ë ¥ì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤.
- ë©€í‹°ëª¨ë‹¬(Multi-modal) ê¸°ëŠ¥ì´ ê°•í™”ë˜ì–´ í…ìŠ¤íŠ¸ë¿ë§Œ ì•„ë‹ˆë¼ ì´ë¯¸ì§€, ìŒì„±, ë¹„ë””ì˜¤ ë“± ë‹¤ì–‘í•œ í˜•íƒœì˜ ë°ì´í„°ë¥¼ ë™ì‹œì— ì´í•´í•˜ê³  ìƒì„±í•˜ëŠ” ëŠ¥ë ¥ì´ ì¤‘ìš”í•´ì§€ê³  ìˆìŠµë‹ˆë‹¤.

ë‚˜. ìƒì„±í˜• AIì˜ í™•ì‚°
- í…ìŠ¤íŠ¸, ì´ë¯¸ì§€, ì½”ë“œ ìƒì„±ì„ ë„˜ì–´ ìŒì•…, ë¹„ë””ì˜¤ ë“± ë‹¤ì–‘í•œ ì½˜í…ì¸  ì œì‘ì— ìƒì„±í˜• AIê°€ í™œìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤.
- ê¸°ì—…ë“¤ì€ ë§ˆì¼€íŒ…, ë””ìì¸, ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ë“± ë‹¤ì–‘í•œ ì—…ë¬´ì— ìƒì„±í˜• AIë¥¼ ë„ì…í•˜ì—¬ ìƒì‚°ì„±ì„ ë†’ì´ê³  ìˆìŠµë‹ˆë‹¤.

ë‹¤. AI ìœ¤ë¦¬ ë° ì±…ì„ì˜ ì¤‘ìš”ì„± ì¦ëŒ€
- AI ê¸°ìˆ ì˜ ë°œì „ê³¼ í•¨ê»˜ í¸í–¥ì„±, ê°œì¸ì •ë³´ ì¹¨í•´, ê°€ì§œ ë‰´ìŠ¤ ë“± ì ì¬ì ì¸ ìœ„í—˜ì— ëŒ€í•œ ìš°ë ¤ë„ ì»¤ì§€ê³  ìˆìŠµë‹ˆë‹¤.
- 'ì„¤ëª… ê°€ëŠ¥í•œ AI(XAI)' ì—°êµ¬ì™€ ê³µì •í•˜ê³  íˆ¬ëª…í•œ AI ê°œë°œì„ ìœ„í•œ ì •ì±… ë° ê·œì œ ë…¼ì˜ê°€ í™œë°œí•˜ê²Œ ì§„í–‰ë˜ê³  ìˆìŠµë‹ˆë‹¤.

3. ê²°ë¡ 
2024ë…„ AI ê¸°ìˆ ì€ ë‹¨ìˆœí•œ ìë™í™”ë¥¼ ë„˜ì–´ ì¸ê°„ì˜ ì°½ì˜ì„±ê³¼ ì§€ëŠ¥ì„ ì¦ê°•ì‹œí‚¤ëŠ” ë°©í–¥ìœ¼ë¡œ ë°œì „í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê¸°ì—…ê³¼ ê°œì¸ì€ ì´ëŸ¬í•œ ê¸°ìˆ  ë³€í™”ì— ëŠ¥ë™ì ìœ¼ë¡œ ëŒ€ì‘í•˜ê³ , ìœ¤ë¦¬ì ì¸ í™œìš© ë°©ì•ˆì„ ëª¨ìƒ‰í•´ì•¼ í•  ê²ƒì…ë‹ˆë‹¤.
'''

INTERACTIVE_DASHBOARD_HTML_CONTENT = '''
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì—…ë¬´ ìë™í™” ë¹„ì„œ (ai-assist-google) | Interactive Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .tab-active { border-color: #0d9488; color: #0d9488; font-weight: 500; }
        .tab-inactive { border-color: transparent; }
        .content-section { display: none; }
        .content-active { display: block; }
        .component-card { transition: all 0.2s ease-in-out; }
        .component-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .setup-step input:checked + label { text-decoration: line-through; color: #9ca3af; }
        .gemini-btn { transition: background-color 0.2s; }
        .gemini-btn:hover { background-color: #0f766e; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0d9488;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-stone-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-teal-700">AI ì—…ë¬´ ìë™í™” ë¹„ì„œ</h1>
            <p class="text-lg text-gray-600 mt-2">Google ì„œë¹„ìŠ¤ì™€ ì—°ë™ëœ Multi-Agent ê¸°ë°˜ AI ì†”ë£¨ì…˜</p>
        </header>

        <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
            <nav class="border-b border-gray-200 mb-6">
                <ul class="flex flex-wrap -mb-px text-sm font-medium text-center text-gray-500">
                    <li class="mr-2">
                        <button id="tab-overview" class="inline-block p-4 border-b-2 rounded-t-lg tab-active">ê°œìš”</button>
                    </li>
                    <li class="mr-2">
                        <button id="tab-architecture" class="inline-block p-4 border-b-2 rounded-t-lg tab-inactive">ì•„í‚¤í…ì²˜</button>
                    </li>
                    <li class="mr-2">
                        <button id="tab-tech" class="inline-block p-4 border-b-2 rounded-t-lg tab-inactive">í•µì‹¬ ê¸°ìˆ </button>
                    </li>
                    <li class="mr-2">
                        <button id="tab-setup" class="inline-block p-4 border-b-2 rounded-t-lg tab-inactive">ì„¤ì¹˜ ë° ì‹¤í–‰</button>
                    </li>
                    <li>
                        <button id="tab-gemini" class="inline-block p-4 border-b-2 rounded-t-lg tab-inactive">âœ¨ AI ê¸°ëŠ¥</button>
                    </li>
                </ul>
            </nav>

            <div id="content-container">
                <!-- Overview Section -->
                <div id="content-overview" class="content-section content-active">
                    <h2 class="text-2xl font-bold mb-4">í”„ë¡œì íŠ¸ ê°œìš”</h2>
                    <p class="mb-6 text-gray-700">ë³¸ í”„ë¡œì íŠ¸ëŠ” Google AI(Gemini), Gmail, Google Calendarì™€ ì—°ë™í•˜ì—¬ ë°˜ë³µì ì¸ ì—…ë¬´ë¥¼ ìë™í™”í•˜ëŠ” AI ë¹„ì„œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. LangChain/LangGraphë¥¼ í™œìš©í•œ Multi-Agent ì•„í‚¤í…ì²˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©ì ìš”ì²­ì˜ ì˜ë„ë¥¼ íŒŒì•…í•˜ê³ , RAGë¥¼ í†µí•´ ë‚´ë¶€ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì—¬ ì •í™•í•˜ê³  í’ë¶€í•œ ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ì›¹ UIë¥¼ í†µí•´ AI ë¹„ì„œì™€ ëŒ€í™”í•˜ë©° ì—…ë¬´ íš¨ìœ¨ì„±ì„ ê·¹ëŒ€í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <div class="grid md:grid-cols-3 gap-4 text-center">
                        <div class="bg-teal-50 p-6 rounded-lg">
                            <span class="text-4xl">ğŸ“§</span>
                            <h3 class="text-lg font-bold mt-2">Gmail ì—°ë™</h3>
                            <p class="text-sm text-gray-600">ë©”ì¼ ê²€ìƒ‰, ìš”ì•½, ë¶„ë¥˜ ìë™í™”</p>
                        </div>
                        <div class="bg-teal-50 p-6 rounded-lg">
                            <span class="text-4xl">ğŸ“…</span>
                            <h3 class="text-lg font-bold mt-2">Calendar ì—°ë™</h3>
                            <p class="text-sm text-gray-600">ì¼ì • ì¡°íšŒ ë° ìš”ì•½</p>
                        </div>
                        <div class="bg-teal-50 p-6 rounded-lg">
                             <span class="text-4xl">ğŸ”</span>
                            <h3 class="text-lg font-bold mt-2">RAG ê¸°ë°˜ ì§€ì‹ê²€ìƒ‰</h3>
                            <p class="text-sm text-gray-600">ë‚´ë¶€ ë¬¸ì„œ ê¸°ë°˜ì˜ ì •í™•í•œ ë‹µë³€</p>
                        </div>
                    </div>
                </div>

                <!-- Architecture Section -->
                <div id="content-architecture" class="content-section">
                     <h2 class="text-2xl font-bold mb-2">ëŒ€í™”í˜• ì•„í‚¤í…ì²˜</h2>
                     <p class="mb-6 text-gray-700">ì•„ë˜ ë‹¤ì´ì–´ê·¸ë¨ì˜ ê° êµ¬ì„± ìš”ì†Œë¥¼ í´ë¦­í•˜ì—¬ ìƒì„¸ ì„¤ëª…ì„ í™•ì¸í•˜ì„¸ìš”. ì „ì²´ ì‹œìŠ¤í…œì€ ì‚¬ìš©ìì˜ ìš”ì²­ì„ ë°›ì•„ ì—¬ëŸ¬ ì „ë¬¸ ì—ì´ì „íŠ¸ì—ê²Œ ì‘ì—…ì„ ë¶„ë°°í•˜ê³ , ìµœì¢… ê²°ê³¼ë¥¼ ì‚¬ìš©ìì—ê²Œ ì „ë‹¬í•˜ëŠ” íë¦„ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.</p>
                    <div class="lg:flex gap-6">
                        <div class="flex-grow grid grid-cols-3 gap-4 items-start">
                            <div class="col-span-1 flex flex-col items-center gap-4">
                                <div class="component-card cursor-pointer w-full p-4 bg-blue-100 text-blue-800 rounded-lg text-center border-2 border-blue-200" data-info="frontend">
                                    <h4 class="font-bold">Frontend</h4><p class="text-sm">(Streamlit)</p>
                                </div>
                            </div>
                            <div class="col-span-1 flex flex-col items-center gap-4">
                               <div class="component-card cursor-pointer w-full p-4 bg-green-100 text-green-800 rounded-lg text-center border-2 border-green-200" data-info="backend">
                                    <h4 class="font-bold">Backend</h4><p class="text-sm">(FastAPI)</p>
                                </div>
                            </div>
                             <div class="col-span-1 flex flex-col items-center gap-4">
                                <div class="component-card cursor-pointer w-full p-4 bg-purple-100 text-purple-800 rounded-lg text-center border-2 border-purple-200" data-info="master_agent">
                                    <h4 class="font-bold">Master Agent</h4><p class="text-sm">(LangGraph)</p>
                                </div>
                            </div>
                            <div class="col-span-3 text-center my-2">
                                <span class="text-2xl font-mono text-gray-400">â†“ â†” â†‘</span>
                            </div>
                            <div class="col-span-3 grid grid-cols-3 gap-4">
                                <div class="component-card cursor-pointer p-3 bg-orange-100 text-orange-800 rounded-lg text-center border-2 border-orange-200" data-info="gmail_agent">
                                    <h4 class="font-semibold">Gmail Agent</h4>
                                </div>
                                <div class="component-card cursor-pointer p-3 bg-orange-100 text-orange-800 rounded-lg text-center border-2 border-orange-200" data-info="calendar_agent">
                                    <h4 class="font-semibold">Calendar Agent</h4>
                                </div>
                                 <div class="component-card cursor-pointer p-3 bg-orange-100 text-orange-800 rounded-lg text-center border-2 border-orange-200" data-info="rag_agent">
                                    <h4 class="font-semibold">RAG Agent</h4>
                                </div>
                            </div>
                             <div class="col-span-3 text-center my-2">
                                <span class="text-2xl font-mono text-gray-400">â†“ â†” â†‘</span>
                            </div>
                            <div class="col-span-3 grid grid-cols-2 gap-4">
                                <div class="component-card cursor-pointer p-3 bg-gray-200 text-gray-800 rounded-lg text-center border-2 border-gray-300" data-info="tools">
                                    <h4 class="font-semibold">Tools</h4>
                                </div>
                                 <div class="component-card cursor-pointer p-3 bg-gray-200 text-gray-800 rounded-lg text-center border-2 border-gray-300" data-info="vector_store">
                                    <h4 class="font-semibold">Vector Store</h4>
                                </div>
                            </div>
                        </div>
                        <div id="architecture-info" class="lg:w-1/3 mt-6 lg:mt-0 p-4 bg-gray-100 rounded-lg h-full">
                            <h3 id="info-title" class="font-bold text-lg mb-2 text-gray-800">ì •ë³´</h3>
                            <p id="info-description" class="text-gray-700">ë‹¤ì´ì–´ê·¸ë¨ì˜ êµ¬ì„± ìš”ì†Œë¥¼ í´ë¦­í•˜ì—¬ ì„¤ëª…ì„ í™•ì¸í•˜ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>

                <!-- Core Technologies Section -->
                <div id="content-tech" class="content-section">
                    <h2 class="text-2xl font-bold mb-2">í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ</h2>
                     <p class="mb-6 text-gray-700">ë³¸ í”„ë¡œì íŠ¸ëŠ” ìµœì‹  AI ë° ì›¹ ê¸°ìˆ ë“¤ì„ ìœ ê¸°ì ìœ¼ë¡œ ê²°í•©í•˜ì—¬ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ê° ê¸°ìˆ ì€ íŠ¹ì • ì—­í• ì„ ìˆ˜í–‰í•˜ë©°, ì „ì²´ ì‹œìŠ¤í…œì˜ ì•ˆì •ì„±ê³¼ í™•ì¥ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.</p>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="p-4 bg-gray-50 border rounded-lg">
                            <h3 class="font-bold text-teal-700">LangGraph</h3>
                            <p class="text-sm text-gray-600">ìƒíƒœ(State)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—¬ëŸ¬ ì—ì´ì „íŠ¸ì™€ ë„êµ¬ë¥¼ ì—°ê²°í•˜ì—¬ ë³µì¡í•œ ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. Master Agentì˜ í•µì‹¬ ë¡œì§ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.</p>
                        </div>
                        <div class="p-4 bg-gray-50 border rounded-lg">
                            <h3 class="font-bold text-teal-700">RAG (Retrieval-Augmented Generation)</h3>
                            <p class="text-sm text-gray-600">ì™¸ë¶€ ë°ì´í„°ë² ì´ìŠ¤(Vector Store)ì—ì„œ ê´€ë ¨ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ì—¬ LLMì˜ ë‹µë³€ì„ ë³´ê°•í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìµœì‹  ì •ë³´ë‚˜ ë‚´ë¶€ ë¬¸ì„œì— ê¸°ë°˜í•œ ì •í™•í•œ ë‹µë³€ ìƒì„±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                        </div>
                        <div class="p-4 bg-gray-50 border rounded-lg">
                            <h3 class="font-bold text-teal-700">ReAct (Tool Agent)</h3>
                            <p class="text-sm text-gray-600">LLMì´ ìŠ¤ìŠ¤ë¡œ ìƒê°(Reasoning)í•˜ê³  í–‰ë™(Action)ì„ ê²°ì •í•˜ëŠ” í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. Gmail, Calendar AgentëŠ” ì´ ë°©ì‹ì„ í†µí•´ APIë¥¼ ë™ì ìœ¼ë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤.</p>
                        </div>
                        <div class="p-4 bg-gray-50 border rounded-lg">
                            <h3 class="font-bold text-teal-700">FastAPI</h3>
                            <p class="text-sm text-gray-600">Python ê¸°ë°˜ì˜ ê³ ì„±ëŠ¥ ì›¹ í”„ë ˆì„ì›Œí¬ë¡œ, ë°±ì—”ë“œ API ì„œë²„ë¥¼ êµ¬ì¶•í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.</p>
                        </div>
                        <div class="p-4 bg-gray-50 border rounded-lg">
                            <h3 class="font-bold text-teal-700">Streamlit</h3>
                            <p class="text-sm text-gray-600">ë°ì´í„° ê³¼í•™ìì™€ AI ì—”ì§€ë‹ˆì–´ë¥¼ ìœ„í•œ í”„ë ˆì„ì›Œí¬ë¡œ, ë¹ ë¥´ê³  ì‰½ê²Œ ëŒ€í™”í˜• UIë¥¼ ê°œë°œí•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.</p>
                        </div>
                         <div class="p-4 bg-gray-50 border rounded-lg">
                            <h3 class="font-bold text-teal-700">FAISS</h3>
                            <p class="text-sm text-gray-600">Facebook AIì—ì„œ ê°œë°œí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ, ëŒ€ê·œëª¨ ë²¡í„° ë°ì´í„°ì˜ íš¨ìœ¨ì ì¸ ìœ ì‚¬ë„ ê²€ìƒ‰ì„ ì§€ì›í•©ë‹ˆë‹¤. Vector DB êµ¬ì¶•ì— ì‚¬ìš©ë©ë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>

                <!-- Setup Section -->
                <div id="content-setup" class="content-section">
                     <h2 class="text-2xl font-bold mb-2">ì„¤ì¹˜ ë° ì‹¤í–‰ ê°€ì´ë“œ</h2>
                     <p class="mb-6 text-gray-700">ì•„ë˜ ë‹¨ê³„ë¥¼ ìˆœì„œëŒ€ë¡œ ë”°ë¼í•˜ì—¬ ë¡œì»¬ í™˜ê²½ì—ì„œ AI ë¹„ì„œ ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° ë‹¨ê³„ë¥¼ ì™„ë£Œí•œ í›„ ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•˜ì—¬ ì§„í–‰ ìƒí™©ì„ ì¶”ì í•˜ì„¸ìš”.</p>
                    <div class="space-y-4">
                        <div class="setup-step border rounded-lg p-4">
                            <input type="checkbox" id="step1" class="mr-2 h-4 w-4 rounded border-gray-300 text-teal-600 focus:ring-teal-600">
                            <label for="step1" class="font-bold text-lg cursor-pointer" onclick="toggleStep('details1')">1. Google Cloud ë° API ì„¤ì •</label>
                            <div id="details1" class="hidden mt-2 pl-6 text-sm space-y-2 text-gray-600">
                                <p>1. Google Cloud Consoleì—ì„œ ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
                                <p>2. `Vertex AI API`, `Gmail API`, `Google Calendar API`ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.</p>
                                <p>3. API í‚¤ì™€ OAuth 2.0 í´ë¼ì´ì–¸íŠ¸ IDë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
                                <p>4. ë‹¤ìš´ë¡œë“œí•œ OAuth ì¸ì¦ ì •ë³´ JSON íŒŒì¼ì„ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `credentials.json`ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                        <div class="setup-step border rounded-lg p-4">
                             <input type="checkbox" id="step2" class="mr-2 h-4 w-4 rounded border-gray-300 text-teal-600 focus:ring-teal-600">
                             <label for="step2" class="font-bold text-lg cursor-pointer" onclick="toggleStep('details2')">2. í”„ë¡œì íŠ¸ í™˜ê²½ ì„¤ì •</label>
                             <div id="details2" class="hidden mt-2 pl-6 text-sm space-y-2 text-gray-600">
                                <p>1. í”„ë¡œì íŠ¸ ì €ì¥ì†Œë¥¼ ë³µì œ(clone)í•˜ê³  `.env` íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.</p>
                                <pre class="bg-gray-800 text-white p-2 rounded-md text-xs">cp .env.example .env</pre>
                                <p>2. `.env` íŒŒì¼ì— 1ë‹¨ê³„ì—ì„œ ë°œê¸‰ë°›ì€ API í‚¤ ë“±ì˜ ì •ë³´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.</p>
                             </div>
                        </div>
                        <div class="setup-step border rounded-lg p-4">
                             <input type="checkbox" id="step3" class="mr-2 h-4 w-4 rounded border-gray-300 text-teal-600 focus:ring-teal-600">
                             <label for="step3" class="font-bold text-lg cursor-pointer" onclick="toggleStep('details3')">3. RAG ë°ì´í„° ì¤€ë¹„</label>
                            <div id="details3" class="hidden mt-2 pl-6 text-sm space-y-2 text-gray-600">
                                <p>1. `documents` ë””ë ‰í† ë¦¬ì— AIê°€ ì°¸ì¡°í•  í…ìŠ¤íŠ¸ íŒŒì¼(e.g., sample_report.txt)ì„ ì¶”ê°€í•©ë‹ˆë‹¤.</p>
                                <p>2. í•„ìš”í•œ Python íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ê³ , ë°ì´í„° ì²˜ë¦¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
                                <pre class="bg-gray-800 text-white p-2 rounded-md text-xs">pip install -r server/requirements.txt\\npython -m server.rag.ingest</pre>
                                <p>â†’ `vector_store/faiss_index` ë””ë ‰í† ë¦¬ì— ë²¡í„° DBê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                         <div class="setup-step border rounded-lg p-4">
                             <input type="checkbox" id="step4" class="mr-2 h-4 w-4 rounded border-gray-300 text-teal-600 focus:ring-teal-600">
                             <label for="step4" class="font-bold text-lg cursor-pointer" onclick="toggleStep('details4')">4. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰</label>
                             <div id="details4" class="hidden mt-2 pl-6 text-sm space-y-2 text-gray-600">
                                <p>1. ìƒˆ í„°ë¯¸ë„ì—ì„œ ë°±ì—”ë“œ ì„œë²„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
                                <pre class="bg-gray-800 text-white p-2 rounded-md text-xs">uvicorn server.main:app --host 0.0.0.0 --port 8000 --reload</pre>
                                <p>2. ë˜ ë‹¤ë¥¸ ìƒˆ í„°ë¯¸ë„ì—ì„œ í”„ë¡ íŠ¸ì—”ë“œ ì•±ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
                                <pre class="bg-gray-800 text-white p-2 rounded-md text-xs">pip install -r app/requirements.txt\\nstreamlit run app/app.py</pre>
                                <p>3. ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:8501` ì£¼ì†Œë¡œ ì ‘ì†í•©ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gemini AI Features Section -->
                <div id="content-gemini" class="content-section">
                    <h2 class="text-2xl font-bold mb-2">âœ¨ Gemini AI ê¸°ë°˜ ê¸°ëŠ¥</h2>
                    <p class="mb-6 text-gray-700">í”„ë¡œì íŠ¸ì— ëŒ€í•œ ì´í•´ë¥¼ ë•ê¸° ìœ„í•´ Gemini AIë¥¼ í™œìš©í•œ ë™ì  ì½˜í…ì¸  ìƒì„± ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ê¶ê¸ˆí•œ ì ì„ AIì—ê²Œ ì§ì ‘ ë¬¼ì–´ë³´ì„¸ìš”.</p>
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- AI Explanation Helper -->
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-bold mb-4">AI ì„¤ëª… ë„ìš°ë¯¸</h3>
                            <p class="text-sm text-gray-600 mb-4">ì•„ë˜ ëª©ë¡ì—ì„œ ê¶ê¸ˆí•œ ê¸°ìˆ  ìš©ì–´ë¥¼ ì„ íƒí•˜ê³  ë²„íŠ¼ì„ ëˆ„ë¥´ë©´, AIê°€ ì•Œê¸° ì‰½ê²Œ ì„¤ëª…í•´ ë“œë¦½ë‹ˆë‹¤.</p>
                            <select id="tech-selector" class="w-full p-2 border border-gray-300 rounded-md mb-4">
                                <option value="LangGraph">LangGraph</option>
                                <option value="RAG">RAG (Retrieval-Augmented Generation)</option>
                                <option value="ReAct">ReAct (Tool Agent)</option>
                                <option value="FAISS">FAISS</option>
                                <option value="Multi-Agent System">Multi-Agent System</option>
                            </select>
                            <button id="explain-btn" class="w-full bg-teal-600 text-white font-bold py-2 px-4 rounded-md gemini-btn">ì„¤ëª… ìš”ì²­</button>
                        </div>
                        
                        <!-- Project Summary Generator -->
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h3 class="text-xl font-bold mb-4">í”„ë¡œì íŠ¸ ìš”ì•½ ìƒì„±ê¸°</h3>
                            <p class="text-sm text-gray-600 mb-4">ì›í•˜ëŠ” ìš”ì•½ ìœ í˜•ì„ ì„ íƒí•˜ë©´, AIê°€ ì´ í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ë‚´ìš©ì„ ê°„ì¶”ë ¤ ë“œë¦½ë‹ˆë‹¤.</p>
                            <select id="summary-selector" class="w-full p-2 border border-gray-300 rounded-md mb-4">
                                <option value="í•œ ë¬¸ì¥ ìš”ì•½">í•œ ë¬¸ì¥ ìš”ì•½</option>
                                <option value="í•µì‹¬ ê¸°ëŠ¥ 3ê°€ì§€">í•µì‹¬ ê¸°ëŠ¥ 3ê°€ì§€</option>
                                <option value="ë¹„ì „ë¬¸ê°€ìš© ìš”ì•½">ë¹„ì „ë¬¸ê°€ìš© ìš”ì•½</option>
                                <option value="ê°œë°œììš© ê¸°ìˆ  ìš”ì•½">ê°œë°œììš© ê¸°ìˆ  ìš”ì•½</option>
                            </select>
                            <button id="summarize-btn" class="w-full bg-teal-600 text-white font-bold py-2 px-4 rounded-md gemini-btn">ìš”ì•½ ìš”ì²­</button>
                        </div>
                    </div>

                    <div id="gemini-output" class="mt-8 p-6 bg-blue-50 border border-blue-200 rounded-lg min-h-[120px]">
                        <p class="text-gray-500">AIì˜ ë‹µë³€ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const tabs = document.querySelectorAll('nav button');
        const contents = document.querySelectorAll('.content-section');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(item => {
                    item.classList.remove('tab-active');
                    item.classList.add('tab-inactive');
                });
                tab.classList.add('tab-active');
                tab.classList.remove('tab-inactive');
                
                const targetId = tab.id.replace('tab-', 'content-');
                contents.forEach(content => {
                    content.classList.remove('content-active');
                });
                document.getElementById(targetId).classList.add('content-active');
            });
        });

        const architectureInfo = {
            frontend: { title: 'Frontend (Streamlit)', description: 'ì‚¬ìš©ìê°€ AIì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” ì›¹ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ë©”ì‹œì§€ë¥¼ ë°±ì—”ë“œ APIë¡œ ì „ì†¡í•˜ê³ , ì‘ë‹µì„ ë°›ì•„ í™”ë©´ì— í‘œì‹œí•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.' },
            backend: { title: 'Backend (FastAPI)', description: 'Streamlit ì•±ì˜ ìš”ì²­ì„ ë°›ì•„ ì²˜ë¦¬í•˜ëŠ” API ì„œë²„ì…ë‹ˆë‹¤. ì‹¤ì œ AI ë¡œì§ì´ ì‹¤í–‰ë˜ëŠ” ê´€ë¬¸ì…ë‹ˆë‹¤.' },
            master_agent: { title: 'Master Agent (LangGraph)', description: 'ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ ê°€ì¥ ë¨¼ì € ë°›ì•„ ì˜ë„ë¥¼ ë¶„ì„í•˜ê³ , ì–´ë–¤ ì „ë¬¸ê°€ ì—ì´ì „íŠ¸ì—ê²Œ ì‘ì—…ì„ ìœ„ì„í• ì§€ ê²°ì •í•˜ëŠ” ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° ì—­í• ì„ í•©ë‹ˆë‹¤.' },
            gmail_agent: { title: 'Gmail Agent', description: 'Google Gmail APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì¼ ìš”ì•½, ê²€ìƒ‰, ë¶„ë¥˜ ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ì „ë¬¸ê°€ ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.' },
            calendar_agent: { title: 'Calendar Agent', description: 'Google Calendar APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì¼ì • ì¡°íšŒ, ìš”ì•½ ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ì „ë¬¸ê°€ ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.' },
            rag_agent: { title: 'RAG Agent', description: 'FAISS ê¸°ë°˜ì˜ Vector DBì— ì €ì¥ëœ ë‚´ë¶€ ë¬¸ì„œë¥¼ ê²€ìƒ‰í•˜ì—¬ ì§ˆë¬¸ì— ë‹µë³€í•˜ëŠ” ì „ë¬¸ê°€ ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.' },
            tools: { title: 'Tools', description: 'ê° ì—ì´ì „íŠ¸ê°€ ì‚¬ìš©í•˜ëŠ” ë„êµ¬(í•¨ìˆ˜)ì˜ ì§‘í•©ì…ë‹ˆë‹¤. ì‹¤ì œ Google APIë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜ Vector DBë¥¼ ê²€ìƒ‰í•˜ëŠ” êµ¬ì²´ì ì¸ ê¸°ëŠ¥ë“¤ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.' },
            vector_store: { title: 'Vector Store (FAISS)', description: 'RAGë¥¼ ìœ„í•´ í…ìŠ¤íŠ¸ ë¬¸ì„œë“¤ì´ ì„ë² ë”©(ë²¡í„°í™”)ë˜ì–´ ì €ì¥ë˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤. AIê°€ ì™¸ë¶€ ì§€ì‹ì„ ì°¸ì¡°í•  ìˆ˜ ìˆë„ë¡ ë•ìŠµë‹ˆë‹¤.' }
        };

        const componentCards = document.querySelectorAll('.component-card');
        const infoTitle = document.getElementById('info-title');
        const infoDescription = document.getElementById('info-description');

        componentCards.forEach(card => {
            card.addEventListener('click', () => {
                const infoKey = card.dataset.info;
                const info = architectureInfo[infoKey];
                infoTitle.textContent = info.title;
                infoDescription.textContent = info.description;
                componentCards.forEach(c => c.classList.remove('ring-2', 'ring-teal-500'));
                card.classList.add('ring-2', 'ring-teal-500');
            });
        });
        
        function toggleStep(detailsId) {
            document.getElementById(detailsId).classList.toggle('hidden');
        }

        // --- Gemini AI Feature Logic ---
        const geminiOutput = document.getElementById('gemini-output');
        const explainBtn = document.getElementById('explain-btn');
        const summarizeBtn = document.getElementById('summarize-btn');
        const techSelector = document.getElementById('tech-selector');
        const summarySelector = document.getElementById('summary-selector');
        
        const projectContext = `
            í”„ë¡œì íŠ¸ ëª…: AI ì—…ë¬´ ìë™í™” ë¹„ì„œ (ai-assist-google)
            í•µì‹¬ ëª©í‘œ: Google AI(Gemini), Gmail, Google Calendarì™€ ì—°ë™í•˜ì—¬ ë°˜ë³µì ì¸ ì—…ë¬´(ë©”ì¼ ì •ë¦¬, ì¼ì • ì¡°ì •, ë³´ê³ ì„œ ìš”ì•½ ë“±)ë¥¼ ìë™í™”í•˜ëŠ” AI ë¹„ì„œ ì„œë¹„ìŠ¤ ê°œë°œ.
            ì£¼ìš” ê¸°ìˆ :
            - Frontend: Streamlit
            - Backend: FastAPI
            - AI Agent ì•„í‚¤í…ì²˜: LangChain, LangGraph ê¸°ë°˜ì˜ Multi-Agent ì‹œìŠ¤í…œ
            - í•µì‹¬ ì—ì´ì „íŠ¸: Master Agent (ì‘ì—… ë¼ìš°íŒ…), Gmail Agent, Calendar Agent, RAG Agent (ë‚´ë¶€ ë¬¸ì„œ ê²€ìƒ‰)
            - ë°ì´í„°ë² ì´ìŠ¤: FAISS ê¸°ë°˜ Vector Store
            - ì¸ì¦: Google OAuth 2.0
        `;

        async function callGemini(prompt) {
            geminiOutput.innerHTML = '<div class="flex items-center justify-center"><div class="loader"></div><p class="ml-4 text-gray-600">AIê°€ ë‹µë³€ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</p></div>';
            
            const apiKey = ""; // API í‚¤ëŠ” Canvas í™˜ê²½ì—ì„œ ìë™ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{
                    role: "user",
                    parts: [{ text: prompt }]
                }]
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    geminiOutput.innerHTML = `<p class="text-gray-800">${text.replace(/\\n/g, '<br>')}</p>`;
                } else {
                    throw new Error("API ì‘ë‹µì—ì„œ ìœ íš¨í•œ ì½˜í…ì¸ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }

            } catch (error) {
                console.error("Gemini API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                geminiOutput.innerHTML = `<p class="text-red-600">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}</p>`;
            }
        }

        explainBtn.addEventListener('click', () => {
            const selectedTech = techSelector.value;
            const prompt = \\`
                ë‹¹ì‹ ì€ AI ê¸°ìˆ  ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì•„ë˜ì˜ ê¸°ìˆ  ìš©ì–´ì— ëŒ€í•´ IT ë¶„ì•¼ì— ìµìˆ™í•˜ì§€ ì•Šì€ ì‚¬ëŒë„ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì‰½ê³  ëª…í™•í•˜ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”. ë¹„ìœ ë¥¼ ë“¤ì–´ ì„¤ëª…í•˜ë©´ ë”ìš± ì¢‹ìŠµë‹ˆë‹¤.

                ê¸°ìˆ  ìš©ì–´: "${selectedTech}"

                ì„¤ëª…:
            \\`;
            callGemini(prompt);
        });

        summarizeBtn.addEventListener('click', () => {
            const summaryType = summarySelector.value;
            const prompt = \`
                ë‹¹ì‹ ì€ ì£¼ì–´ì§„ í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ë¶„ì„í•˜ì—¬ ëª…í™•í•˜ê²Œ ìš”ì•½í•˜ëŠ” AI ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
                
                ì•„ë˜ í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ, ìš”ì²­ëœ ìœ í˜•ì— ë§ê²Œ ìš”ì•½ë¬¸ì„ í•œêµ­ì–´ë¡œ ìƒì„±í•´ì£¼ì„¸ìš”.

                [í”„ë¡œì íŠ¸ ì •ë³´]
                ${projectContext}

                [ìš”ì•½ ìš”ì²­ ìœ í˜•]
                "${summaryType}"

                ìš”ì•½ë¬¸:
            \`;
            callGemini(prompt);
        });

    </script>
</body>
</html>
'''

# --- íŒŒì¼ ìƒì„± ë¡œì§ ---

def create_project_files():
    '''í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ì™€ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.'''
    
    # íŒŒì¼ ê²½ë¡œì™€ ë‚´ìš©ì„ ë§¤í•‘
    files_to_create = {
        "ai-assist-google/README.md": README_MD_CONTENT,
        "ai-assist-google/.env.example": ENV_EXAMPLE_CONTENT,
        "ai-assist-google/app/app.py": APP_PY_CONTENT,
        "ai-assist-google/app/requirements.txt": APP_REQUIREMENTS_TXT_CONTENT,
        "ai-assist-google/server/main.py": SERVER_MAIN_PY_CONTENT,
        "ai-assist-google/server/requirements.txt": SERVER_REQUIREMENTS_TXT_CONTENT,
        "ai-assist-google/server/api/chat.py": API_CHAT_PY_CONTENT,
        "ai-assist-google/server/agents/__init__.py": "",
        "ai-assist-google/server/agents/state.py": AGENTS_STATE_PY_CONTENT,
        "ai-assist-google/server/agents/master_agent.py": AGENTS_MASTER_AGENT_PY_CONTENT,
        "ai-assist-google/server/agents/specialist_agents.py": AGENTS_SPECIALIST_AGENTS_PY_CONTENT,
        "ai-assist-google/server/core/config.py": CORE_CONFIG_PY_CONTENT,
        "ai-assist-google/server/rag/__init__.py": "",
        "ai-assist-google/server/rag/ingest.py": RAG_INGEST_PY_CONTENT,
        "ai-assist-google/server/rag/retriever.py": RAG_RETRIEVER_PY_CONTENT,
        "ai-assist-google/server/tools/__init__.py": "",
        "ai-assist-google/server/tools/google_services.py": TOOLS_GOOGLE_SERVICES_PY_CONTENT,
        "ai-assist-google/documents/sample_report.txt": SAMPLE_REPORT_TXT_CONTENT,
        "ai-assist-google/vector_store/faiss_index/.gitkeep": "",
        "ai-assist-google/interactive_dashboard.html": INTERACTIVE_DASHBOARD_HTML_CONTENT
    }

    print("í”„ë¡œì íŠ¸ íŒŒì¼ ìƒì„±ì„ ì‹œì‘í•©ë‹ˆë‹¤...")

    for file_path, content in files_to_create.items():
        # ë””ë ‰í† ë¦¬ ìƒì„±
        dir_name = os.path.dirname(file_path)
        if not os.path.exists(dir_name):
            os.makedirs(dir_name)
            print(f"  ë””ë ‰í† ë¦¬ ìƒì„±: {dir_name}")

        # íŒŒì¼ ìƒì„± ë° ë‚´ìš© ì‘ì„±
        try:
            with open(file_path, "w", encoding="utf-8") as f:
                # textwrap.dedentë¥¼ ì‚¬ìš©í•˜ì—¬ ê³µí†µ ë“¤ì—¬ì“°ê¸° ì œê±°
                f.write(textwrap.dedent(content).strip())
            print(f"  âœ“ íŒŒì¼ ìƒì„±: {file_path}")
        except IOError as e:
            print(f"  âœ— íŒŒì¼ ìƒì„± ì˜¤ë¥˜: {file_path} ({e})")

    print("\ní”„ë¡œì íŠ¸ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!")
    print("ì´ì œ 'ai-assist-google' ë””ë ‰í† ë¦¬ë¥¼ VS Codeì—ì„œ ì—´ê³  README.md íŒŒì¼ì„ ì°¸ê³ í•˜ì—¬ ê°œë°œì„ ì‹œì‘í•˜ì„¸ìš”.")

if __name__ == "__main__":
    create_project_files()

  ```
"""